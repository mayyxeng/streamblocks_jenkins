<?xml version='1.1' encoding='UTF-8'?>
<project>
  <actions/>
  <description>Shell build template for xclbins</description>
  <keepDependencies>false</keepDependencies>
  <properties>
    <jenkins.model.BuildDiscarderProperty>
      <strategy class="hudson.tasks.LogRotator">
        <daysToKeep>-1</daysToKeep>
        <numToKeep>3</numToKeep>
        <artifactDaysToKeep>-1</artifactDaysToKeep>
        <artifactNumToKeep>3</artifactNumToKeep>
      </strategy>
    </jenkins.model.BuildDiscarderProperty>
    <hudson.model.ParametersDefinitionProperty>
      <parameterDefinitions>
        <hudson.model.FileParameterDefinition>
          <name>submission_file</name>
          <description>A tar file containing the generated project.</description>
        </hudson.model.FileParameterDefinition>
        <hudson.model.StringParameterDefinition>
          <name>FPGA_NAME</name>
          <description></description>
          <defaultValue>xcu250-figd2104-2L-e</defaultValue>
          <trim>false</trim>
        </hudson.model.StringParameterDefinition>
        <hudson.model.StringParameterDefinition>
          <name>PLATFORM</name>
          <description></description>
          <defaultValue>xilinx_u250_xdma_201830_2</defaultValue>
          <trim>false</trim>
        </hudson.model.StringParameterDefinition>
        <hudson.model.StringParameterDefinition>
          <name>HLS_CLOCK_PERIOD</name>
          <description></description>
          <defaultValue>3.3</defaultValue>
          <trim>false</trim>
        </hudson.model.StringParameterDefinition>
        <hudson.model.StringParameterDefinition>
          <name>KERNEL_FREQ</name>
          <description></description>
          <defaultValue>300</defaultValue>
          <trim>false</trim>
        </hudson.model.StringParameterDefinition>
        <hudson.model.StringParameterDefinition>
          <name>MPSOC_CLOCK_ID</name>
          <description></description>
          <defaultValue>0</defaultValue>
          <trim>false</trim>
        </hudson.model.StringParameterDefinition>
        <hudson.model.StringParameterDefinition>
          <name>IS_MPSOC</name>
          <description></description>
          <defaultValue>OFF</defaultValue>
          <trim>false</trim>
        </hudson.model.StringParameterDefinition>
        <hudson.model.StringParameterDefinition>
          <name>TARGET</name>
          <description></description>
          <defaultValue>hw</defaultValue>
          <trim>false</trim>
        </hudson.model.StringParameterDefinition>
        <hudson.model.StringParameterDefinition>
          <name>NETWORK_NAME</name>
          <description></description>
          <defaultValue></defaultValue>
          <trim>false</trim>
        </hudson.model.StringParameterDefinition>
      </parameterDefinitions>
    </hudson.model.ParametersDefinitionProperty>
  </properties>
  <scm class="hudson.scm.NullSCM"/>
  <canRoam>true</canRoam>
  <disabled>false</disabled>
  <blockBuildWhenDownstreamBuilding>false</blockBuildWhenDownstreamBuilding>
  <blockBuildWhenUpstreamBuilding>false</blockBuildWhenUpstreamBuilding>
  <triggers/>
  <concurrentBuild>false</concurrentBuild>
  <builders>
    <hudson.tasks.Shell>
      <command>echo &quot;Prepaing build ${JOB_NAME}:${BUILD_NUMBER} on ${NODE_NAME}:${EXECUTOR_NUMBER} at ${JENKINS_URL} in directory ${WORKSPACE}&quot;
mkdir -p project
if [ -f &quot;submission_file&quot; ]; then
    echo &quot;submission received.&quot;
else
	echo &quot;missing a submission file!&quot;
    exit 1
fi

if [ -z &quot;${NETWORK_NAME}&quot; ]; then
	echo &quot;NETWORK_NAME not specified!&quot;
    exit 2
	
else
	echo &quot;NETWORK_NAME = ${NETWORK_NAME}&quot;
fi</command>
      <configuredLocalRules/>
    </hudson.tasks.Shell>
    <hudson.tasks.Shell>
      <command>tar -xzf submission_file -C project
echo &quot;Submission extracted&quot;
mkdir -p project/build
</command>
      <configuredLocalRules/>
    </hudson.tasks.Shell>
    <hudson.tasks.Shell>
      <command>cd project/build
source /home/emami/streamblocks_init
vitis_init
echo &quot;XILINX_XRT = ${XILINX_XRT}&quot;
echo &quot;XILINX_VITIS = ${XILINX_VITIS}&quot;
echo &quot;XILINX_VIVADO = ${XILINX_VIVADO}&quot;
echo &quot;Configuring the build&quot;
configs=&quot;-DUSE_VITIS=on -DPLATFORM=${PLATFORM} -DTARGET=${TARGET} -DFPGA_NAME=${FPGA_NAME} -DHLS_CLOCK_PERIOD=${HLS_CLOCK_PERIOD} -DKERNEL_FREQ=${KERNEL_FREQ} -DIS_MPSOC=${IS_MPSOC}&quot; 
if [ &quot;$IS_MPSOC&quot; = &apos;ON&apos; ]; then
	configs=&quot;$configs -DMPSOC_CLOCK_ID=${MPSOC_CLOCK_ID}&quot;
fi
cmake .. $configs
</command>
      <configuredLocalRules/>
    </hudson.tasks.Shell>
    <hudson.tasks.Shell>
      <command>cd project/build
source /home/emami/streamblocks_init
vitis_init
echo &quot;Making XO&quot;
make ${NETWORK_NAME}_kernel_xo -j 4</command>
      <configuredLocalRules/>
    </hudson.tasks.Shell>
    <hudson.tasks.Shell>
      <command>cd project/build
source /home/emami/streamblocks_init
vitis_init
echo &quot;Making xclbin&quot;
make ${NETWORK_NAME}_kernel_xclbin -j
echo &quot;XCLBIN build done!&quot;
cd ../bin/
tar -czf ${JOB_NAME}_${BUILD_NUMBER}_xclbin.tar.gz xclbin
tar -czf ${JOB_NAME}_${BUILD_NUMBER}_reports.tar.gz ../build/vivado-hls/_x/reports ../build/vivado-hls/_x/link/int/_new_clk_freq
echo &quot;xclbin available at ${WORKSPACE}/project/bin/${JOB_NAME}_${BUILD_NUMBER}_xclbin.tar.gz&quot;
</command>
      <configuredLocalRules/>
    </hudson.tasks.Shell>
  </builders>
  <publishers/>
  <buildWrappers>
    <hudson.plugins.ws__cleanup.PreBuildCleanup plugin="ws-cleanup@0.38">
      <deleteDirs>false</deleteDirs>
      <cleanupParameter></cleanupParameter>
      <externalDelete></externalDelete>
      <disableDeferredWipeout>false</disableDeferredWipeout>
    </hudson.plugins.ws__cleanup.PreBuildCleanup>
    <hudson.plugins.timestamper.TimestamperBuildWrapper plugin="timestamper@1.11.8"/>
  </buildWrappers>
</project>